<html>
  <title>Feet & Inch Calculator</title>
  <body onload="updateResult()"
      style="margin: 1em 2em; font-family: system-ui; color: #212121">
    <script type="text/javascript">

      // A curious thing worth noting: It turns out that fractions of the form
      // "n / power-of-2" are precicely the values that can be represented exactly
      // in floating point arithmetic and also the conventional way of expressing
      // fractional inches. So doing all arithmetic in units of inches means that
      // calculations can be exact when exact results are possible.

      function getField(name, def) {
        document.getElementById(name).style.color = '';
        let val = document.getElementById(name).value.trim();
        if (val === "") return def;
        val = Number(val);
        if (isNaN(val) || (val === 0 && def !== 0))
          document.getElementById(name).style.color = 'red';
        return val;
      }

      function num2str(val) {
        // Avoids display of nonsense like 2.5000...001 while
        // maintaining accuracy to 10 decimal digits.
        val = val.toPrecision(10);
        if (val.includes('e'))  // watch out for scientific notation!
          return val;
        while (val.endsWith("0"))
          val = val.substr(0, val.length-1);
        if (val.endsWith("."))
          val = val.substr(0, val.length-1);
        return val;
      }

      function updateResult() {
        const isDiv0 = (val) => !isFinite(val) && !isNaN(val);
        // Assume success: show results element and hide error element
        document.getElementById('results').style.display = '';
        document.getElementById('error').style.display = 'none';
        try {
          let ft = getField('ft', 0);
          let inch = getField('inch', 0);
          let num = getField('num', 0);
          let denom = getField('denom', 1);
          let times = getField('times', 1);
          let div = getField('div', 1);

          let totalInches = (ft*12 + inch + num/denom);
          if (isDiv0(totalInches)) throw "Divide by zero";

          totalInches = totalInches * times / div;
          if (isDiv0(totalInches)) throw "Divide by zero";
          if (isNaN(totalInches)) throw "Bad input";

          document.getElementById('resultIn').textContent = num2str(totalInches);
          document.getElementById('resultFt').textContent = num2str(totalInches/12);

          // Recover feet and inches from from result
          // (round to nearest 1/denom)
          denom = 32;
          let inches =  ((totalInches*denom + 0.5)|0)/denom;
          ft = (inches/12)|0;      // "n|0" truncates to an integer
          inches = inches - ft*12;
          let frac = inches - (inches|0);
          inches = inches|0;
          num = (frac*denom)|0;
          while (denom > 2 && num%2 === 0) {  // reduce fraction
            denom = denom/2;
            num = num/2;
          }

          // format that string and output it
          let str = "";
          if (ft !== 0 || (inches === 0 && num === 0))
            str += ft + "'";
          if (inches !== 0)
            str += " " + inches;
          if (num !== 0)
            str += " " + num + "/" + denom;
          if (inches !== 0 || num !== 0)
             str += '"';
          let delta = totalInches - (ft*12 + inches + num/denom);
          if (Math.abs(delta) < 1.0e-10) {
            delta = "";
          } else {
            if (delta < 0)
              delta = " - " + num2str(-delta) + '"';
            else
              delta = " + " + num2str(delta) + '"';
          }
          str += delta
          document.getElementById('resultFtDetail').textContent = str;

          // format inches
          str = "" + (12*ft + inches);
          if (num !== 0)
            str += " " + num + "/" + denom;
          str += '"' + delta;
          document.getElementById('resultInDetail').textContent = str;

          // show metric for good measure
          document.getElementById('resultMeters').textContent =
            num2str(totalInches * 0.0254);
          document.getElementById('resultMetersMetricFeet').textContent =
            num2str(totalInches * 0.025);
        }
        catch (e) {
          // we had an error so hide the results block and show the error block
          document.getElementById('results').style.display = 'none';
          document.getElementById('error').style.display = '';
          document.getElementById('error').textContent = String(e);
        }
      }
    </script>
    <p style="transform-origin: left; transform: scale(1.5)">
      <input type="text" onchange="updateResult()" size="4" id="ft" value="5"> ft
      <input type="text" onchange="updateResult()" size="4" id="inch" value=""> in
      &nbsp;&nbsp;
      <input type="text" onchange="updateResult()" size="2" id="num" value=""> /
      <input type="text" onchange="updateResult()" size="2" id="denom" value="8">
      &nbsp;&nbsp;
      times <input type="text" onchange="updateResult()" size="2" id="times" value="">
      divided by <input type="text" onchange="updateResult()" size="2" id="div" value="">
    </p>
    <div style="float: left; min-width: 30em; border: 2px solid; margin: 10px 0px; padding: 0px 10px">
      <p id="results">
        <span id="resultFt"></span> feet = <span id="resultFtDetail"></span>
        <br>
        <span id="resultIn"></span> inches = <span id="resultInDetail"></span>
        <br>
        <span id="resultMeters"></span> meters
        <br>
        <span id="resultMetersMetricFeet"></span> meters (assuming "metric feet")
      </p>
      <p id="error" style="color: red"></p>
    </div>
    <div style="font-size: 85%; clear: both">
      <bl>
        <li>
          Hit enter/return to calculate
        </li>
        <li>
          Fields may be left empty when not relevent
        </li>
        <li>
          A value like five and a half feet may be entered as 5.5 ft or as 5 ft 6 inches
        </li>
        <li>
          A value like six and a quarter inches may be entered as 6.25 inches or
          as 6 inches and 1/4
        </li>
        <li>
          A "metric foot" is a convention for metric designs where a foot is taken
          to be exactly 30cm instead of 30.48cm
        </li>
      </bl>
    </div>
  </body>
</html>